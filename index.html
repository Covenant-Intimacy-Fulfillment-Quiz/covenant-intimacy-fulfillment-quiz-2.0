<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Combined Marriage Assessment</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #fff9f2; color: #1a3c5e; max-width: 900px; margin: auto; padding: 20px; }
    h1,h2,h3 { text-align: center; }
    .card { background: #fff; border: 2px solid #4d9de0; border-radius: 12px; padding: 25px; box-shadow: 0 8px 25px rgba(0,0,0,0.08); margin: 20px auto; max-width: 700px; text-align: center; }
    .btn, .answer-btn { background: #4d9de0; color: white; font-weight: bold; border: none; border-radius: 8px; padding: 12px 20px; cursor: pointer; margin: 10px 0; display: block; width: 100%; max-width: 300px; }
    .btn:hover, .answer-btn:hover { background: #3a7fbf; }
    .hidden { display:none; }
    .progress { font-weight: bold; margin: 10px 0; }
    .result-block { background:#f0f4f9; border-left:6px solid #4d9de0; padding:15px; margin:15px 0; text-align:left; }
    .email-form input { padding:10px; margin:5px; width:80%; max-width:300px; }
  </style>
</head>
<body>

<div id="introPage" class="card">
  <h1>Discover Your Connection Profile</h1>
  <p>Answer 26 situational questions to reveal how you love, connect, and build trust in marriage.</p>
  <button class="btn" onclick="startQuiz()">Start Assessment</button>
</div>

<div id="quizPage" class="card hidden">
  <h2>Questionnaire</h2>
  <div class="progress" id="progress"></div>
  <div id="questionContainer"></div>
</div>

<div id="resultPage" class="card hidden">
  <h2>Your Personalized Profile</h2>
  <div id="results"></div>

  <div class="email-form">
    <input type="text" id="nameInput" placeholder="Your Name"/>
    <input type="email" id="emailInput" placeholder="Your Email"/>
    <button class="btn" onclick="downloadPDF()">Download PDF</button>
  </div>

  <div class="card" style="margin-top:20px;">
    <h3>Couples Comparison</h3>
    <p>Share your code with your spouse and paste theirs to see combined insights.</p>
    <input type="text" id="partnerCode" placeholder="Partner's Code"/>
    <button class="btn" onclick="compareResults()">Compare</button>
    <div id="comparison"></div>
  </div>
</div>

<script>
/* ---------------- DATA ---------------- */
const questions = [
  /* Temperament (1–10) */
  {q:"When your spouse is stressed, you naturally…", opts:[
    {t:"Sanguine", i:"Affable"}, {t:"Choleric", i:"Partnership"}, {t:"Melancholy", i:"Intellectual"},
    {t:"Phlegmatic", i:"Emotional"}, {t:"Supine", i:"Spiritual"}]},
  {q:"On a weekend, you prefer to…", opts:[
    {t:"Sanguine", i:"Recreational"}, {t:"Choleric", i:"Partnership"}, {t:"Melancholy", i:"Creative"},
    {t:"Phlegmatic", i:"Emotional"}, {t:"Supine", i:"Spiritual"}]},
  {q:"When your spouse is sad, you…", opts:[
    {t:"Sanguine", i:"Affable"}, {t:"Choleric", i:"Commitment"}, {t:"Melancholy", i:"Emotional"},
    {t:"Phlegmatic", i:"Physical"}, {t:"Supine", i:"Spiritual"}]},
  {q:"In group settings, you…", opts:[
    {t:"Sanguine", i:"Affable"}, {t:"Choleric", i:"Partnership"}, {t:"Melancholy", i:"Intellectual"},
    {t:"Phlegmatic", i:"Emotional"}, {t:"Supine", i:"Spiritual"}]},
  {q:"When planning a date night, you prefer…", opts:[
    {t:"Sanguine", i:"Recreational"}, {t:"Choleric", i:"Commitment"}, {t:"Melancholy", i:"Creative"},
    {t:"Phlegmatic", i:"Physical"}, {t:"Supine", i:"Spiritual"}]},
  {q:"When making decisions, you…", opts:[
    {t:"Sanguine", i:"Affable"}, {t:"Choleric", i:"Partnership"}, {t:"Melancholy", i:"Intellectual"},
    {t:"Phlegmatic", i:"Emotional"}, {t:"Supine", i:"Commitment"}]},
  {q:"During conflict, you are most likely to…", opts:[
    {t:"Sanguine", i:"Affable"}, {t:"Choleric", i:"Conflict"}, {t:"Melancholy", i:"Intellectual"},
    {t:"Phlegmatic", i:"Emotional"}, {t:"Supine", i:"Commitment"}]},
  {q:"When expressing affection, you…", opts:[
    {t:"Sanguine", i:"Affable"}, {t:"Choleric", i:"Partnership"}, {t:"Melancholy", i:"Creative"},
    {t:"Phlegmatic", i:"Physical"}, {t:"Supine", i:"Spiritual"}]},
  {q:"If you had extra time in the day, you would…", opts:[
    {t:"Sanguine", i:"Recreational"}, {t:"Choleric", i:"Partnership"}, {t:"Melancholy", i:"Creative"},
    {t:"Phlegmatic", i:"Emotional"}, {t:"Supine", i:"Spiritual"}]},
  {q:"When your spouse forgets to thank you, you…", opts:[
    {t:"Sanguine", i:"Affable"}, {t:"Choleric", i:"Commitment"}, {t:"Melancholy", i:"Emotional"},
    {t:"Phlegmatic", i:"Physical"}, {t:"Supine", i:"Spiritual"}]},
  /* Intimacy (11–20) */
  {q:"I feel most loved when my spouse…", opts:[
    {i:"Recreational"}, {i:"Spiritual"}, {i:"Physical"}, {i:"Partnership"}, {i:"Emotional"}]},
  {q:"When I feel disconnected, I wish we could…", opts:[
    {i:"Affable"}, {i:"Commitment"}, {i:"Emotional"}, {i:"Physical"}, {i:"Spiritual"}]},
  {q:"My favorite quality time is…", opts:[
    {i:"Recreational"}, {i:"Creative"}, {i:"Physical"}, {i:"Intellectual"}, {i:"Spiritual"}]},
  {q:"I feel safest in marriage when…", opts:[
    {i:"Conflict"}, {i:"Commitment"}, {i:"Physical"}, {i:"Affable"}, {i:"Spiritual"}]},
  {q:"I feel proud of our marriage when…", opts:[
    {i:"Financial"}, {i:"Spiritual"}, {i:"Affable"}, {i:"Creative"}, {i:"Intellectual"}]},
  {q:"After a long day, what makes me feel most connected?", opts:[
    {i:"Physical"}, {i:"Affable"}, {i:"Partnership"}, {i:"Emotional"}, {i:"Spiritual"}]},
  {q:"I feel most cared for when…", opts:[
    {i:"Partnership"}, {i:"Spiritual"}, {i:"Emotional"}, {i:"Affable"}, {i:"Physical"}]},
  {q:"A great day together includes…", opts:[
    {i:"Recreational"}, {i:"Intellectual"}, {i:"Commitment"}, {i:"Spiritual"}, {i:"Physical"}]},
  {q:"When we argue, what helps me feel safe?", opts:[
    {i:"Affable"}, {i:"Conflict"}, {i:"Physical"}, {i:"Spiritual"}, {i:"Emotional"}]},
  {q:"I feel closest when…", opts:[
    {i:"Recreational"}, {i:"Partnership"}, {i:"Emotional"}, {i:"Spiritual"}, {i:"Physical"}]},
  /* Bonding (21–26) */
  {q:"When conflict happens, I usually…", opts:[
    {b:"Anchored Connector"}, {b:"Assurance Seeker"}, {b:"Steady Soul"}, {b:"Tender Protector"}]},
  {q:"If my spouse seems distant, I…", opts:[
    {b:"Anchored Connector"}, {b:"Assurance Seeker"}, {b:"Steady Soul"}, {b:"Tender Protector"}]},
  {q:"After a fight, I…", opts:[
    {b:"Anchored Connector"}, {b:"Assurance Seeker"}, {b:"Steady Soul"}, {b:"Tender Protector"}]},
  {q:"When I feel hurt, I…", opts:[
    {b:"Anchored Connector"}, {b:"Assurance Seeker"}, {b:"Steady Soul"}, {b:"Tender Protector"}]},
  {q:"I feel safest when…", opts:[
    {b:"Anchored Connector"}, {b:"Assurance Seeker"}, {b:"Steady Soul"}, {b:"Tender Protector"}]},
  {q:"If I sense rejection, I…", opts:[
    {b:"Anchored Connector"}, {b:"Assurance Seeker"}, {b:"Steady Soul"}, {b:"Tender Protector"}]}
];

let index=0,tempScores={},intimacyScores={},bondingScores={};
["Sanguine","Choleric","Melancholy","Phlegmatic","Supine"].forEach(t=>tempScores[t]=0);
["Anchored Connector","Assurance Seeker","Steady Soul","Tender Protector"].forEach(b=>bondingScores[b]=0);

function startQuiz(){
  document.getElementById("introPage").classList.add("hidden");
  document.getElementById("quizPage").classList.remove("hidden");
  showQuestion();
}

function showQuestion(){
  const q=questions[index];
  document.getElementById("progress").textContent=`Question ${index+1} of ${questions.length}`;
  let html=`<h3>${q.q}</h3>`;
  q.opts.forEach((o,i)=> html+=`<button class="answer-btn" onclick="answer(${i})">Option ${String.fromCharCode(65+i)}</button>`);
  document.getElementById("questionContainer").innerHTML=html;
}

function answer(optIndex){
  const o=questions[index].opts[optIndex];
  if(o.t) tempScores[o.t]++; if(o.i) intimacyScores[o.i]=(intimacyScores[o.i]||0)+1; if(o.b) bondingScores[o.b]++;
  index++;
  if(index<questions.length) showQuestion();
  else showResults();
}

function showResults(){
  document.getElementById("quizPage").classList.add("hidden");
  document.getElementById("resultPage").classList.remove("hidden");
  const topTemp=Object.entries(tempScores).sort((a,b)=>b[1]-a[1]);
  const topInt=Object.entries(intimacyScores).sort((a,b)=>b[1]-a[1]);
  const topBond=Object.entries(bondingScores).sort((a,b)=>b[1]-a[1])[0][0];
  let html=`<div class='result-block'><strong>Primary Temperament:</strong> ${topTemp[0][0]}<br><strong>Secondary Temperament:</strong> ${topTemp[1][0]}</div>`;
  html+=`<div class='result-block'><strong>Top 3 Intimacy Needs:</strong> ${topInt.slice(0,3).map(i=>i[0]).join(", ")}</div>`;
  html+=`<div class='result-block'><strong>Bonding Style:</strong> ${topBond}</div>`;
  html+=`<div class='result-block'><strong>Your Results Code:</strong><br>${btoa(JSON.stringify({tempScores,intimacyScores,bondingScores}))}</div>`;
  document.getElementById("results").innerHTML=html;
}

function downloadPDF(){
  const {jsPDF}=window.jspdf;
  const pdf=new jsPDF();
  pdf.setFontSize(16); pdf.text("Connection Profile",20,20);
  pdf.setFontSize(12); pdf.text(document.getElementById("results").innerText,20,40,{maxWidth:170});
  pdf.save("ConnectionProfile.pdf");
}

function compareResults(){
  const partnerCode=document.getElementById("partnerCode").value;
  try{
    const partner=JSON.parse(atob(partnerCode));
    const combined={};
    for(let k in intimacyScores){combined[k]=(intimacyScores[k]||0)+(partner.intimacyScores?.[k]||0);}
    const topShared=Object.entries(combined).sort((a,b)=>b[1]-a[1]).slice(0,3);
    document.getElementById("comparison").innerHTML=`<p><strong>Shared Top Intimacy Priorities:</strong> ${topShared.map(x=>x[0]).join(", ")}</p>`;
  }catch{ alert("Invalid partner code"); }
}
</script>
</body>
</html>
