<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Discover Your Top Intimacy Needs</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

  <style>
    body { font-family: Arial, sans-serif; background: #fff9f2; color: #1a3c5e; max-width: 800px; margin: auto; padding: 20px; }
    h1, h2, h3 { text-align: center; }

    .question-card {
      max-width: 600px;
      margin: 20px auto;
      background: #ffffff;
      border: 2px solid #4d9de0;
      border-radius: 12px;
      padding: 25px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.08);
      text-align: center;
    }

    .answer-btn {
      display: block;
      width: 100%;
      margin: 10px 0;
      padding: 14px;
      background: #4d9de0;
      color: #fff;
      font-size: 1rem;
      font-weight: bold;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    .answer-btn:hover { background: #3a7fbf; }

    .branding-under-question { text-align: center; font-size: 0.9rem; color: #777; margin-top: 10px; }

    button {
      background: #4d9de0;
      color: white;
      border: none;
      padding: 12px 24px;
      font-size: 16px;
      border-radius: 5px;
      cursor: pointer;
      margin: 10px;
    }
    button:hover { background:#3a7fbf; }

    .description-block {
      background: #f0f4f9;
      border-left: 5px solid #4d9de0;
      padding: 15px;
      margin-bottom: 20px;
    }

    #introPage { text-align: center; margin-top: 60px; }
    .intro-container {
      max-width: 600px;
      margin: 0 auto;
      background: #ffffff;
      border: 2px solid #4d9de0;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.08);
    }
    .intro-container h1 { font-size: 2rem; color: #1a3c5e; margin-bottom: 15px; }
    .intro-container p { font-size: 1.1rem; color: #333; margin-bottom: 30px; line-height: 1.5; }
    .start-btn {
      padding: 14px 28px;
      font-size: 1.2rem;
      font-weight: bold;
      color: #fff;
      background: #4d9de0;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    .start-btn:hover { background: #3a7fbf; }

    .form-section { text-align: center; margin-top: 20px; }
    .form-section input {
      padding: 10px;
      margin: 5px;
      width: 70%;
      max-width: 300px;
      display: block;
      margin-left: auto;
      margin-right: auto;
    }

    .next-steps-box { background: #e5f8e8; border-left: 6px solid #4CAF50; padding: 15px; margin-top: 30px; }

    #introLogo, #resultsLogo { max-width: 220px; display: block; margin: 0 auto 20px auto; }
    #successMessage { text-align: center; color: green; font-weight: bold; display: none; }
  </style>
</head>
<body>

<!-- ✅ INTRO PAGE -->
<div id="introPage">
  <div class="intro-container">
    <img src="logo.png" id="introLogo" alt="Logo" />
    <h1>What Makes You Feel Deeply Loved?</h1>
    <p>Answer 24 simple questions to reveal the unique ways you connect best—and learn how to create a stronger bond with your spouse.</p>
    <button id="startQuiz" class="start-btn">Start My Quiz</button>
  </div>
</div>

<!-- ✅ QUIZ SECTION -->
<div id="quizSection" style="display:none;">
  <h1>What Are Your Top Intimacy Needs?</h1>
  <div class="progress" id="progressText">Question 1 of 24</div>
  <form id="quizForm">
    <div id="quiz"></div>
    <div style="text-align:center;">
      <button type="button" id="backButton" style="display:none;">Back</button>
    </div>
  </form>
  <div class="branding-under-question">happymarriagehappylife.com</div>
</div>

<!-- ✅ RESULTS SECTION -->
<div id="resultSection" style="display:none; text-align:center;">
  <img src="logo.png" id="resultsLogo" alt="Logo" />
  <h2>Your Personalized Intimacy Profile</h2>
  <div id="descriptions"></div>

  <div class="form-section" id="emailSection">
    <input type="text" id="nameInput" placeholder="Your Name" required />
    <input type="email" id="emailInput" placeholder="Your Email" required />
    <button id="sendButton" disabled>Send & Download My Results</button>
  </div>

  <p id="successMessage">✅ Your results have been sent, and your PDF has been downloaded!</p>

  <div class="next-steps-box">
    <strong>What To Do Next:</strong><br/>
    Share your top intimacy needs with your spouse. Choose one small, practical action this week to grow in each area.
  </div>
</div>

<script>
/* ✅ QUESTIONS + DESCRIPTIONS */
const questions = [
 { q:"I feel most connected when we share spiritual beliefs or pray together.",type:"Spiritual"},
 { q:"I value deep emotional conversations where I feel fully heard and understood.",type:"Emotional"},
 { q:"Having respectful, honest communication—especially during conflict—is important to me.",type:"Conflict"},
 { q:"I enjoy growing intellectually together—learning, reading, or discussing ideas.",type:"Intellectual"},
 { q:"Being physically close (hugs, cuddles, kisses) helps me feel secure.",type:"Physical"},
 { q:"I feel loved when we share sexual closeness and intimacy.",type:"Sexual"},
 { q:"Having shared responsibilities and making decisions as a team matters to me.",type:"Partnership"},
 { q:"I feel safe and connected when we handle tough situations together, not apart.",type:"Conflict"},
 { q:"Spending quality, lighthearted time (laughing, relaxing, having fun) strengthens us.",type:"Affable"},
 { q:"Creating art, music, or other creative experiences together brings me joy.",type:"Creative"},
 { q:"When we manage money together responsibly and transparently, I feel connected.",type:"Financial"},
 { q:"Affectionate touch and presence (like holding hands or snuggling) is very meaningful.",type:"Physical"},
 { q:"I appreciate kind and thoughtful actions done without being asked.",type:"Affable"},
 { q:"Deep heart talks and mutual emotional vulnerability create strong closeness for me.",type:"Emotional"},
 { q:"I feel secure when we set goals together and make decisions as partners.",type:"Partnership"},
 { q:"Shared faith and a common spiritual direction unites us.",type:"Spiritual"},
 { q:"I need to feel sexually desired and enjoyed by my partner.",type:"Sexual"},
 { q:"Playful time, laughing, or even watching a show together helps me connect.",type:"Affable"},
 { q:"It’s important to me that we can talk respectfully even during arguments.",type:"Conflict"},
 { q:"Using money wisely and discussing purchases builds trust and closeness.",type:"Financial"},
 { q:"Collaborating on creative things or solving problems creatively makes me feel alive.",type:"Creative"},
 { q:"I love when we pray together, read Scripture, or serve with shared faith.",type:"Spiritual"},
 { q:"We grow closer when we talk about values, dreams, and big ideas.",type:"Intellectual"},
 { q:"Being emotionally safe and not judged lets me open my heart.",type:"Emotional"}
];

const intimacyDescriptions = {
  Spiritual:"Shared faith and values form the foundation of your bond.",
  Emotional:"You long to feel emotionally safe and deeply known.",
  Intellectual:"You enjoy connecting through thoughtful conversations.",
  Physical:"Being close through touch helps you feel safe and loved.",
  Sexual:"Sexual intimacy expresses affection, passion, and closeness.",
  Conflict:"You value staying connected even during disagreements.",
  Partnership:"You thrive when responsibilities and decisions are shared.",
  Affable:"Playfulness, kindness, and joy build your connection.",
  Creative:"Creative activities and imagination inspire closeness.",
  Financial:"Transparency with money strengthens trust and unity."
};

const typeColors={Spiritual:"#FF4D4D",Emotional:"#4D9DE0",Intellectual:"#1A3C5E",Physical:"#FDC57B",Sexual:"#92C9D6",Conflict:"#F67599",Partnership:"#D07E5F",Affable:"#A1B56C",Creative:"#C084FC",Financial:"#7BC1D1"};

let scores={}, currentQuestion=0, answers=[], quizFinished=false;
Object.keys(intimacyDescriptions).forEach(t=>scores[t]=0);
answers = Array(questions.length).fill(null);

function saveState(){
  localStorage.setItem("quizState", JSON.stringify({ scores, answers, currentQuestion, quizFinished }));
}
function loadState(){
  const saved = localStorage.getItem("quizState");
  if(saved){
    const state = JSON.parse(saved);
    scores = state.scores;
    answers = state.answers;
    currentQuestion = state.currentQuestion;
    quizFinished = state.quizFinished;
  }
}

function showQuestion(i){
  const quizContainer=document.getElementById("quiz");
  quizContainer.innerHTML="";
  const progressText=document.getElementById("progressText");

  const q=questions[i];
  const card=document.createElement("div");
  card.className="question-card";

  const questionText=document.createElement("h3");
  questionText.textContent=q.q;
  card.appendChild(questionText);

  const options=[
    {text:"Strongly Agree",value:5},
    {text:"Agree",value:4},
    {text:"Neutral",value:3},
    {text:"Disagree",value:2},
    {text:"Strongly Disagree",value:1}
  ];

  options.forEach(opt=>{
    const btn=document.createElement("button");
    btn.textContent=opt.text;
    btn.className="answer-btn";
    if(answers[i]===opt.value) btn.style.background="#3a7fbf";

    btn.addEventListener("click",()=>{
      if(answers[i]!==null) scores[q.type]-=answers[i];
      answers[i]=opt.value;
      scores[q.type]+=opt.value;

      currentQuestion++;
      if(currentQuestion<questions.length){
        saveState();
        showQuestion(currentQuestion);
      }else{
        quizFinished=true;
        saveState();
        document.getElementById("quizSection").style.display="none";
        document.getElementById("resultSection").style.display="block";
        displayResults();
      }
    });
    card.appendChild(btn);
  });

  quizContainer.appendChild(card);
  progressText.textContent=`Question ${i+1} of ${questions.length}`;
  document.getElementById("backButton").style.display=i>0?"inline-block":"none";
}

document.getElementById("backButton").addEventListener("click",()=>{
  if(currentQuestion>0){
    currentQuestion--;
    saveState();
    showQuestion(currentQuestion);
  }
});

function displayResults(){
  const sorted=Object.entries(scores).sort((a,b)=>b[1]-a[1]);
  const priority=sorted.slice(0,4),progress=sorted.slice(4,8),presence=sorted.slice(8,12);

  function sectionHTML(title,text,items){
    return `<h3>${title}</h3><p>${text}</p>${items.map(([t,s])=>
      `<div class="description-block" style="border-left:8px solid ${typeColors[t]}"><strong>${t}</strong> (Score: ${s})<br/>${intimacyDescriptions[t]}</div>`).join("")}`;
  }

  document.getElementById("descriptions").innerHTML =
    `<p><strong>Explanation of Your Results:</strong> Your Personalized Intimacy Profile is based on the Covenant Intimacy Fulfillment Model™.</p>`+
    sectionHTML("Priority – Your Highest Intimacy Needs","These are the areas that matter most to you.",priority)+
    sectionHTML("Progress – Areas for Growth","These are meaningful but may not feel as urgent.",progress)+
    sectionHTML("Presence – Often Overlooked, Still Essential","Lowest scoring but still important areas.",presence)+
    `<p><strong>Remember:</strong> A thriving marriage values all 12 types of intimacy.</p>`;
}

document.getElementById("startQuiz").addEventListener("click",()=>{
  document.getElementById("introPage").style.display="none";
  document.getElementById("quizSection").style.display="block";
  currentQuestion=0;
  scores={}; Object.keys(intimacyDescriptions).forEach(t=>scores[t]=0);
  answers=Array(questions.length).fill(null);
  quizFinished=false;
  saveState();
  showQuestion(currentQuestion);
});

const nameInput=document.getElementById("nameInput");
const emailInput=document.getElementById("emailInput");
const sendButton=document.getElementById("sendButton");
[nameInput,emailInput].forEach(el=>el.addEventListener("input",()=>sendButton.disabled=!(nameInput.value&&emailInput.value)));

sendButton.addEventListener("click", async ()=>{
  await fetch("https://formspree.io/f/xgvzkwre", {
    method:"POST",headers:{"Content-Type":"application/json"},
    body:JSON.stringify({name:nameInput.value,email:emailInput.value,scores:JSON.stringify(scores)})
  });
  generatePDF();
  document.getElementById("successMessage").style.display="block";
});

window.addEventListener("DOMContentLoaded",()=>{
  loadState();
  if(quizFinished){
    document.getElementById("introPage").style.display="none";
    document.getElementById("quizSection").style.display="none";
    document.getElementById("resultSection").style.display="block";
    displayResults();
  }
});

/* ✅ PDF GENERATOR (leave as-is from your code) */
async function generatePDF(){
  const {jsPDF}=window.jspdf;
  const pdf=new jsPDF("p","pt","a4");
  const pageWidth=pdf.internal.pageSize.getWidth();
  const pageHeight=pdf.internal.pageSize.getHeight();
  const marginX=30,marginY=40,usableWidth=pageWidth-marginX*2;

  const logo=new Image(); logo.src="logo.png"; await new Promise(r=>logo.onload=r);
  pdf.addImage(logo,"PNG",pageWidth/2-90,70,180,90);
  pdf.setFont("helvetica","bold"); pdf.setFontSize(24);
  pdf.text("Your Personalized Intimacy Profile",pageWidth/2,200,{align:"center"});
  pdf.setFont("helvetica","normal"); pdf.setFontSize(14);
  pdf.text("Based on the Covenant Intimacy Fulfillment Model™",pageWidth/2,225,{align:"center"});

  const userName=nameInput.value||"Valued User";
  const today=new Date().toLocaleDateString(undefined,{month:"long",day:"numeric",year:"numeric"});
  pdf.setFontSize(12); pdf.text(`Prepared for ${userName} – ${today}`,pageWidth/2,250,{align:"center"});

  pdf.setFont("helvetica","bold"); pdf.setFontSize(14);
  pdf.text("Discover Your Path to Deeper Connection",pageWidth/2,300,{align:"center"});
  pdf.setFont("helvetica","normal"); pdf.setFontSize(12);
  pdf.text("This profile reveals how you uniquely prioritize the 12 types of intimacy God designed for marriage. See your Priority, Progress, and Presence areas—and learn how each one can bring you and your spouse closer than ever.",pageWidth/2,330,{align:"center",maxWidth:usableWidth});
  pdf.setFont("helvetica","italic");
  pdf.text("This profile is based on the Covenant Intimacy Fulfillment Model™ (CIFM), developed through the research of Dr. Scott Inman, PhD—founder of the Happy Marriage, Happy Life™ marriage curriculum and resources.",pageWidth/2,400,{align:"center",maxWidth:usableWidth});

  pdf.setFillColor("#4D9DE0");
  pdf.rect(marginX,pageHeight-50,usableWidth,40,"F");
  pdf.setTextColor("#FFFFFF");
  pdf.setFont("helvetica","bold"); pdf.setFontSize(12);
  pdf.text("HappyMarriageHappyLife.com  |  Helping Couples Build Lasting Love",pageWidth/2,pageHeight-25,{align:"center"});

  pdf.addPage();

  const resultClone=document.getElementById("resultSection").cloneNode(true);
  const emailForm=resultClone.querySelector("#emailSection");
  if(emailForm) emailForm.remove();

  const pieces=[];
  const sections=resultClone.querySelectorAll("h3");
  sections.forEach(section=>{
    const block=document.createElement("div");
    block.appendChild(section.cloneNode(true));
    let sibling=section.nextElementSibling;
    while(sibling&&sibling.tagName!=="H3"){block.appendChild(sibling.cloneNode(true)); sibling=sibling.nextElementSibling;}
    pieces.push(block);
  });

  let yPos=marginY;
  for(let piece of pieces){
    const tempDiv=document.createElement("div");
    tempDiv.style.width="700px";
    tempDiv.appendChild(piece);
    document.body.appendChild(tempDiv);

    const canvas=await html2canvas(tempDiv,{scale:2,useCORS:true});
    document.body.removeChild(tempDiv);

    const imgData=canvas.toDataURL("image/png");
    const imgProps=pdf.getImageProperties(imgData);
    const imgHeight=(imgProps.height*usableWidth)/imgProps.width;

    if(yPos+imgHeight>pageHeight-80){ pdf.addPage(); yPos=marginY; }
    pdf.addImage(imgData,"PNG",marginX,yPos,usableWidth,imgHeight);
    yPos+=imgHeight+15;
  }

  pdf.save("Intimacy-Results.pdf");
}
</script>
</body>
</html>
