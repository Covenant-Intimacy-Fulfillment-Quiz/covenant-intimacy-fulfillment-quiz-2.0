<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Marriage Connection Quiz</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #fff9f2; color: #1a3c5e; max-width: 900px; margin: auto; padding: 20px; }
    h1,h2,h3 { text-align: center; }
    .card { background: #fff; border: 2px solid #4d9de0; border-radius: 12px; padding: 25px; box-shadow: 0 8px 25px rgba(0,0,0,0.08); margin: 20px auto; max-width: 750px; text-align: center; }
    .btn, .answer-btn { background: #4d9de0; color: white; font-weight: bold; border: none; border-radius: 8px; padding: 12px 20px; cursor: pointer; margin: 10px 0; display: block; width: 100%; max-width: 500px; }
    .btn:hover, .answer-btn:hover { background: #3a7fbf; }
    .hidden { display:none; }
    .progress { font-weight: bold; margin: 10px 0; }
    .result-block { margin:15px 0; text-align:left; padding:15px; border-radius:8px; }
    .logo { display:block; margin:0 auto 15px auto; max-width:200px; }
  </style>
</head>
<body>

<div id="introPage" class="card">
  <img src="logo.png" class="logo" alt="Logo"/>
  <h1>Discover Your Marriage Connection Profile</h1>
  <p>Answer 26 situational questions to reveal how you love, connect, and build trust in marriage.</p>
  <button id="startQuizBtn" class="btn">Start Assessment</button>
</div>

<div id="quizPage" class="card hidden">
  <h2>Questionnaire</h2>
  <div class="progress" id="progress"></div>
  <div id="questionContainer"></div>
</div>

<div id="resultPage" class="card hidden">
  <img src="logo.png" class="logo" alt="Logo"/>
  <h2>Your Personalized Connection Profile</h2>
  <canvas id="intimacyChart" style="max-width:700px; margin:auto;"></canvas>
  <div id="results"></div>
  <div class="email-form">
    <input type="text" id="nameInput" placeholder="Your Name"/>
    <input type="email" id="emailInput" placeholder="Your Email"/>
    <button class="btn" onclick="sendAndGeneratePDF()">Send & Download PDF</button>
  </div>
</div>

<script>
/* ============================
   ðŸ”¹ INTIMACY DESCRIPTIONS
============================ */
const intimacyDescriptions = {
  Spiritual: "Shared faith and values form the foundation of your bond.",
  Emotional: "You long to feel emotionally safe and deeply known.",
  Commitment: "You thrive when trust and covenant loyalty feel secure.",
  Intellectual: "You enjoy connecting through thoughtful conversations.",
  Affable: "Playfulness, kindness, and joy build your connection.",
  Recreational: "Fun and shared activities strengthen your bond.",
  Partnership: "You value teamwork and shared decision-making.",
  Financial: "Transparency with money strengthens trust and unity.",
  Creative: "Collaborating on ideas or projects brings you closer.",
  Conflict: "Respectful resolution of disagreements deepens intimacy.",
  Physical: "Being close through touch helps you feel safe and loved.",
  Sexual: "Sexual intimacy expresses affection, passion, and closeness."
};

const typeColors = {
  Spiritual:"#FF4D4D", Emotional:"#4D9DE0", Commitment:"#1A3C5E",
  Intellectual:"#C084FC", Affable:"#A1B56C", Recreational:"#FDC57B",
  Partnership:"#D07E5F", Financial:"#7BC1D1", Creative:"#E085B2",
  Conflict:"#F67599", Physical:"#92C9D6", Sexual:"#E6A94C"
};
// ========================
//   QUIZ QUESTIONS
// ========================
const questions = [
  {q:"When your spouse is stressed, you naturallyâ€¦", opts:[
    {text:"Crack a joke or lighten the mood", t:"Sanguine", i:"Affable"},
    {text:"Take charge and fix the issue", t:"Choleric", i:"Partnership"},
    {text:"Offer thoughtful solutions or deep advice", t:"Melancholy", i:"Intellectual"},
    {text:"Sit close, listen, and reassure quietly", t:"Phlegmatic", i:"Emotional"},
    {text:"Pray or serve without being asked", t:"Supine", i:"Spiritual"}]},
    
  {q:"On a weekend, you prefer toâ€¦", opts:[
    {text:"Do something fun or spontaneous", t:"Sanguine", i:"Recreational"},
    {text:"Work on a project or goal", t:"Choleric", i:"Partnership"},
    {text:"Read, think, or create", t:"Melancholy", i:"Creative"},
    {text:"Relax with family quietly", t:"Phlegmatic", i:"Emotional"},
    {text:"Help or serve in some way", t:"Supine", i:"Spiritual"}]},
    
  {q:"When your spouse is sad, you tend toâ€¦", opts:[
    {text:"Make them laugh", t:"Sanguine", i:"Affable"},
    {text:"Try to fix their problem", t:"Choleric", i:"Commitment"},
    {text:"Offer a deep talk", t:"Melancholy", i:"Emotional"},
    {text:"Give comfort through presence", t:"Phlegmatic", i:"Physical"},
    {text:"Do a kind, helpful act", t:"Supine", i:"Spiritual"}]},
    
  {q:"In group settings, youâ€¦", opts:[
    {text:"Talk and engage everyone", t:"Sanguine", i:"Affable"},
    {text:"Take the lead or organize", t:"Choleric", i:"Partnership"},
    {text:"Listen and analyze", t:"Melancholy", i:"Intellectual"},
    {text:"Stay relaxed and follow along", t:"Phlegmatic", i:"Emotional"},
    {text:"Quietly support others", t:"Supine", i:"Spiritual"}]},
    
  {q:"When planning a date night, you preferâ€¦", opts:[
    {text:"Something fun or surprising", t:"Sanguine", i:"Recreational"},
    {text:"Something productive or goal-oriented", t:"Choleric", i:"Commitment"},
    {text:"A deep, meaningful activity", t:"Melancholy", i:"Creative"},
    {text:"Something low-key and comforting", t:"Phlegmatic", i:"Physical"},
    {text:"Something that serves or honors your spouse", t:"Supine", i:"Spiritual"}]},
    
  {q:"When making decisions, youâ€¦", opts:[
    {text:"Go with what feels fun", t:"Sanguine", i:"Affable"},
    {text:"Decide quickly and take charge", t:"Choleric", i:"Partnership"},
    {text:"Think through details", t:"Melancholy", i:"Intellectual"},
    {text:"Go along to keep peace", t:"Phlegmatic", i:"Emotional"},
    {text:"Ask what others want first", t:"Supine", i:"Commitment"}]},
    
  {q:"During conflict, you are most likely toâ€¦", opts:[
    {text:"Joke to ease tension", t:"Sanguine", i:"Affable"},
    {text:"Push for solutions", t:"Choleric", i:"Conflict"},
    {text:"Retreat to think first", t:"Melancholy", i:"Intellectual"},
    {text:"Stay calm and avoid escalation", t:"Phlegmatic", i:"Emotional"},
    {text:"Try to please the other person", t:"Supine", i:"Commitment"}]},
    
  {q:"When expressing affection, youâ€¦", opts:[
    {text:"Use fun words and excitement", t:"Sanguine", i:"Affable"},
    {text:"Do things for your spouse", t:"Choleric", i:"Partnership"},
    {text:"Write or say meaningful things", t:"Melancholy", i:"Creative"},
    {text:"Use touch or quiet presence", t:"Phlegmatic", i:"Physical"},
    {text:"Serve or sacrifice quietly", t:"Supine", i:"Spiritual"}]},
    
  {q:"If you had extra time in the day, you wouldâ€¦", opts:[
    {text:"Plan a fun activity", t:"Sanguine", i:"Recreational"},
    {text:"Get something accomplished", t:"Choleric", i:"Partnership"},
    {text:"Work on a personal project", t:"Melancholy", i:"Creative"},
    {text:"Relax or nap", t:"Phlegmatic", i:"Emotional"},
    {text:"Help your spouse or family", t:"Supine", i:"Spiritual"}]},
    
  {q:"When your spouse forgets to thank you, youâ€¦", opts:[
    {text:"Laugh it off", t:"Sanguine", i:"Affable"},
    {text:"Remind them of your effort", t:"Choleric", i:"Commitment"},
    {text:"Feel hurt but stay quiet", t:"Melancholy", i:"Emotional"},
    {text:"Assume they didnâ€™t mean it", t:"Phlegmatic", i:"Physical"},
    {text:"Keep serving anyway", t:"Supine", i:"Spiritual"}]},
    
  {q:"I feel most loved when my spouseâ€¦", opts:[
    {text:"Plans fun time together", i:"Recreational"},
    {text:"Prays with me", i:"Spiritual"},
    {text:"Shows physical affection", i:"Physical"},
    {text:"Makes joint decisions with me", i:"Partnership"},
    {text:"Talks deeply with me", i:"Emotional"}]},
    
  {q:"When I feel disconnected, I wish we couldâ€¦", opts:[
    {text:"Share laughs and inside jokes", i:"Affable"},
    {text:"Work on shared goals", i:"Commitment"},
    {text:"Have a deep talk", i:"Emotional"},
    {text:"Be affectionate without pressure", i:"Physical"},
    {text:"Pray or worship together", i:"Spiritual"}]},
    
  {q:"My favorite quality time isâ€¦", opts:[
    {text:"Spontaneous outings", i:"Recreational"},
    {text:"Talking about dreams", i:"Creative"},
    {text:"Cuddling or being close", i:"Physical"},
    {text:"Learning and growing together", i:"Intellectual"},
    {text:"Serving in faith together", i:"Spiritual"}]},
    
  {q:"I feel safest in marriage whenâ€¦", opts:[
    {text:"We solve conflict well", i:"Conflict"},
    {text:"Weâ€™re united in big decisions", i:"Commitment"},
    {text:"Weâ€™re consistently affectionate", i:"Physical"},
    {text:"Weâ€™re laughing and having fun", i:"Affable"},
    {text:"We share faith and values", i:"Spiritual"}]},
    
  {q:"I feel proud of our marriage whenâ€¦", opts:[
    {text:"We manage life and money well", i:"Financial"},
    {text:"We pray and serve together", i:"Spiritual"},
    {text:"We stay playful", i:"Affable"},
    {text:"We build or create something together", i:"Creative"},
    {text:"We grow through deep talks", i:"Intellectual"}]},
    
  {q:"After a long day, what makes me feel most connected?", opts:[
    {text:"Snuggling or holding hands", i:"Physical"},
    {text:"Sharing a fun moment", i:"Affable"},
    {text:"Working together on something simple", i:"Partnership"},
    {text:"Talking about the day", i:"Emotional"},
    {text:"Praying together", i:"Spiritual"}]},
    
  {q:"I feel most cared for whenâ€¦", opts:[
    {text:"My spouse does tasks for me", i:"Partnership"},
    {text:"We pray together", i:"Spiritual"},
    {text:"They listen deeply", i:"Emotional"},
    {text:"We laugh together", i:"Affable"},
    {text:"They surprise me with affection", i:"Physical"}]},
    
  {q:"A great day together includesâ€¦", opts:[
    {text:"A fun activity", i:"Recreational"},
    {text:"A meaningful talk", i:"Intellectual"},
    {text:"Mutual decision-making", i:"Commitment"},
    {text:"Spiritual connection", i:"Spiritual"},
    {text:"Physical affection", i:"Physical"}]},
    
  {q:"When we argue, what helps me feel safe?", opts:[
    {text:"Humor", i:"Affable"},
    {text:"Clear solutions", i:"Conflict"},
    {text:"Being held", i:"Physical"},
    {text:"Praying together", i:"Spiritual"},
    {text:"Deep talk to understand each other", i:"Emotional"}]},
    
  {q:"I feel closest whenâ€¦", opts:[
    {text:"We laugh and have fun", i:"Recreational"},
    {text:"We achieve something together", i:"Partnership"},
    {text:"We talk deeply", i:"Emotional"},
    {text:"We share our faith", i:"Spiritual"},
    {text:"We are physically close", i:"Physical"}]},
    
  {q:"When conflict happens, I usuallyâ€¦", opts:[
    {text:"Talk it out calmly", b:"Anchored Connector"},
    {text:"Seek reassurance and closeness", b:"Assurance Seeker"},
    {text:"Withdraw to think first", b:"Steady Soul"},
    {text:"Feel unsure if I can trust or stay close", b:"Tender Protector"}]},
    
  {q:"If my spouse seems distant, Iâ€¦", opts:[
    {text:"Ask calmly about it", b:"Anchored Connector"},
    {text:"Worry theyâ€™re upset with me", b:"Assurance Seeker"},
    {text:"Wait for them to come to me", b:"Steady Soul"},
    {text:"Assume the worst", b:"Tender Protector"}]},
    
  {q:"After a fight, Iâ€¦", opts:[
    {text:"Try to reconnect quickly", b:"Anchored Connector"},
    {text:"Need lots of reassurance", b:"Assurance Seeker"},
    {text:"Prefer space before reconnecting", b:"Steady Soul"},
    {text:"Struggle to feel safe trusting again", b:"Tender Protector"}]},
    
  {q:"When I feel hurt, Iâ€¦", opts:[
    {text:"Express my feelings calmly", b:"Anchored Connector"},
    {text:"Get anxious or clingy", b:"Assurance Seeker"},
    {text:"Keep it inside", b:"Steady Soul"},
    {text:"Pull away or shut down", b:"Tender Protector"}]},
    
  {q:"I feel safest whenâ€¦", opts:[
    {text:"We talk and repair things quickly", b:"Anchored Connector"},
    {text:"My spouse reassures me often", b:"Assurance Seeker"},
    {text:"My spouse gives me space", b:"Steady Soul"},
    {text:"I see proof they can be trusted", b:"Tender Protector"}]},
    
  {q:"If I sense rejection, Iâ€¦", opts:[
    {text:"Communicate honestly", b:"Anchored Connector"},
    {text:"Worry or overthink", b:"Assurance Seeker"},
    {text:"Avoid conflict", b:"Steady Soul"},
    {text:"Assume Iâ€™ll be let down", b:"Tender Protector"}]}
  ];
</script>
/* ============================
   ðŸ”¹ STATE + HELPERS
============================ */
let index=0, tempScores={}, intimacyScores={}, bondingScores={};
["Sanguine","Choleric","Melancholy","Phlegmatic","Supine"].forEach(t=>tempScores[t]=0);

function getAffectionPreferences() {
  const highest = Object.entries(tempScores).sort((a,b)=>b[1]-a[1])[0][0];
  switch(highest){
    case "Sanguine": return {expressed:"Playful, verbal, and spontaneous affection", desired:"Emotional connection and physical touch"};
    case "Choleric": return {expressed:"Acts of service and shared goals", desired:"Respect for decisions and partnership"};
    case "Melancholy": return {expressed:"Thoughtful, deep, and creative gestures", desired:"Emotional depth and consistency"};
    case "Phlegmatic": return {expressed:"Quiet presence, reliability, and calm care", desired:"Gentle affection and security"};
    case "Supine": return {expressed:"Loyal, selfless service", desired:"Feeling pursued, affirmed, and emotionally safe"};
    default: return {expressed:"Balanced affection", desired:"Balanced needs"};
  }
}

function getBondingStyle() {
  const highest = Object.entries(bondingScores).sort((a,b)=>b[1]-a[1])[0]?.[0] || "Anchored Connector";
  switch(highest){
    case "Anchored Connector": return "You feel safe with trust and open communication, reconnecting easily after conflict.";
    case "Assurance Seeker": return "You thrive with frequent reassurance and closeness, feeling loved when affection is consistent.";
    case "Steady Soul": return "You prefer steady, low-pressure connection and feel safest with calm interactions.";
    case "Tender Protector": return "You need trust proven over time and may hesitate to depend on others until security is clear.";
    default: return "";
  }
}

/* ============================
   ðŸ”¹ QUIZ FLOW
============================ */
document.getElementById("startQuizBtn").addEventListener("click", startQuiz);

function startQuiz(){
  document.getElementById("introPage").classList.add("hidden");
  document.getElementById("quizPage").classList.remove("hidden");
  showQuestion();
}

function showQuestion(){
  const q = questions[index];
  document.getElementById("progress").textContent = `Question ${index+1} of ${questions.length}`;
  let html = `<h3>${q.q}</h3>`;
  q.opts.forEach((o,i)=>{
    html += `<button class="answer-btn" onclick="answer(${i})">${o.text}</button>`;
  });
  document.getElementById("questionContainer").innerHTML = html;
}

function answer(i){
  const o = questions[index].opts[i];
  if(o.t) tempScores[o.t]++;
  if(o.i) intimacyScores[o.i]=(intimacyScores[o.i]||0)+1;
  if(o.b) bondingScores[o.b]=(bondingScores[o.b]||0)+1;
  index++;
  index<questions.length ? showQuestion() : showResults();
}

/* ============================
   ðŸ”¹ RESULTS PAGE
============================ */
function showResults(){
  document.getElementById("quizPage").classList.add("hidden");
  document.getElementById("resultPage").classList.remove("hidden");

  const sorted = Object.entries(intimacyScores).sort((a,b)=>b[1]-a[1]);
  const priority = sorted.slice(0,4), progress = sorted.slice(4,8), presence = sorted.slice(8,12);

  function sectionHTML(title,text,items){
    return `<h3>${title}</h3><p>${text}</p>` +
    items.map(([type,score])=>`
      <div class="result-block" style="border-left:8px solid ${typeColors[type]}">
        <strong>${type}</strong> (Score: ${score})<br/>${intimacyDescriptions[type]}
      </div>`).join("");
  }

  document.getElementById("results").innerHTML =
    sectionHTML("Priority â€“ Your Highest Intimacy Needs","These areas are most important for you to feel loved and connected.",priority)+
    sectionHTML("Progress â€“ Areas for Growth","These matter to you but may not feel as urgent as your top needs.",progress)+
    sectionHTML("Presence â€“ Often Overlooked, Still Essential","These are lower-scoring areas but still valuable for connection.",presence);

  const affection = getAffectionPreferences();
  const bonding = getBondingStyle();

  document.getElementById("results").innerHTML += `
    <hr/><h3>Affection Preferences</h3>
    <p><strong>Expressed Affection:</strong> ${affection.expressed}</p>
    <p><strong>Desired Affection Preference:</strong> ${affection.desired}</p>
    <h3>Bonding Style</h3><p>${bonding}</p>`;

  const ctx=document.getElementById("intimacyChart");
  new Chart(ctx,{type:"bar",data:{labels:sorted.map(([t])=>t),
    datasets:[{label:"Scores",data:sorted.map(([_,s])=>s),backgroundColor:sorted.map(([t])=>typeColors[t])}] }});
}

/* ============================
   ðŸ”¹ EMAIL + PDF
============================ */
async function sendAndGeneratePDF(){
  const name=document.getElementById("nameInput").value;
  const email=document.getElementById("emailInput").value;
  await fetch("https://formspree.io/f/xgvzkwre",{method:"POST",headers:{"Content-Type":"application/json"},
    body:JSON.stringify({name,email,scores:intimacyScores})});
  generatePDF();
}

async function generatePDF(){
  const {jsPDF}=window.jspdf;
  const pdf=new jsPDF("p","pt","a4");
  const pageWidth=pdf.internal.pageSize.getWidth();
  const pageHeight=pdf.internal.pageSize.getHeight();
  const marginX=40,marginY=50,usableWidth=pageWidth-marginX*2;

  const logo=new Image(); logo.src="logo.png"; await new Promise(r=>logo.onload=r);
  pdf.addImage(logo,"PNG",pageWidth/2-90,70,180,90);
  pdf.setFont("helvetica","bold"); pdf.setFontSize(24);
  pdf.text("Your Personalized Intimacy Profile",pageWidth/2,200,{align:"center"});
  pdf.setFont("helvetica","normal"); pdf.setFontSize(14);
  pdf.text("Based on the Covenant Intimacy Fulfillment Modelâ„¢",pageWidth/2,225,{align:"center"});
  const userName=document.getElementById("nameInput").value||"Valued User";
  const today=new Date().toLocaleDateString(undefined,{month:"long",day:"numeric",year:"numeric"});
  pdf.setFontSize(12); pdf.text(`Prepared for ${userName} â€“ ${today}`,pageWidth/2,250,{align:"center"});
  pdf.setFillColor("#4D9DE0");
  pdf.rect(marginX,pageHeight-50,usableWidth,40,"F");
  pdf.setTextColor("#FFFFFF");
  pdf.setFont("helvetica","bold"); pdf.setFontSize(12);
  pdf.text("HappyMarriageHappyLife.com  |  Helping Couples Build Lasting Love",pageWidth/2,pageHeight-25,{align:"center"});

  pdf.addPage();

  const sorted=Object.entries(intimacyScores).sort((a,b)=>b[1]-a[1]);
  const priority=sorted.slice(0,4),progress=sorted.slice(4,8),presence=sorted.slice(8,12);

  function addSection(title,text,items,y){
    pdf.setTextColor("#000"); pdf.setFont("helvetica","bold"); pdf.setFontSize(16); pdf.text(title,marginX,y);
    pdf.setFont("helvetica","normal"); pdf.setFontSize(12); pdf.text(text,marginX,y+18,{maxWidth:usableWidth});
    let yPos=y+40;
    items.forEach(([type,score])=>{
      pdf.setFillColor(typeColors[type]); pdf.rect(marginX,yPos,6,6,"F");
      pdf.setTextColor("#000"); pdf.text(`${type} (Score: ${score})`,marginX+12,yPos+5);
      const desc=pdf.splitTextToSize(intimacyDescriptions[type],usableWidth-20);
      pdf.text(desc,marginX+12,yPos+20); yPos+=desc.length*14+25;
    }); return yPos;
  }

  let y=marginY;
  y=addSection("Priority â€“ Your Highest Intimacy Needs","These areas are most important for you to feel loved and connected.",priority,y);
  y=addSection("Progress â€“ Areas for Growth","These matter to you but may not feel as urgent as your top needs.",progress,y+20);
  addSection("Presence â€“ Often Overlooked, Still Essential","These are lower-scoring areas but still valuable for connection.",presence,y+20);

  pdf.addPage();
  const affection=getAffectionPreferences(),bonding=getBondingStyle();
  pdf.setFont("helvetica","bold"); pdf.setFontSize(16);
  pdf.text("Affection Preferences",marginX,marginY);
  pdf.setFont("helvetica","normal"); pdf.setFontSize(12);
  pdf.text(`Expressed Affection: ${affection.expressed}`,marginX,marginY+25,{maxWidth:usableWidth});
  pdf.text(`Desired Affection Preference: ${affection.desired}`,marginX,marginY+45,{maxWidth:usableWidth});
  pdf.setFont("helvetica","bold"); pdf.setFontSize(16);
  pdf.text("Bonding Style",marginX,marginY+90);
  pdf.setFont("helvetica","normal"); pdf.setFontSize(12);
  pdf.text(bonding,marginX,marginY+110,{maxWidth:usableWidth});

  pdf.save("Intimacy-Results.pdf");
}
</script>
</body>
</html>
