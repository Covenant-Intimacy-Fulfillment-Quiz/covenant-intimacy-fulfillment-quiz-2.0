<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Marriage Connection Assessment — Single Partner</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@500&family=Open+Sans:wght@600;700&family=Merriweather:ital,wght@1,400;1,700&family=Pacifico&display=swap" rel="stylesheet">
<style>
  body { font-family: Arial, sans-serif; background:#FFF9F2; color:#1A3C5E; max-width: 980px; margin:auto; padding:20px; box-sizing:border-box; }
  h1,h2,h3,h4{ text-align:center; line-height:1.25; }
  .card { background:#fff; border:2px solid #4D9DE0; border-radius:12px; padding:24px; box-shadow:0 8px 25px rgba(0,0,0,.08); margin: 20px auto; }
  .btn, .answer-btn { background:#4D9DE0; color:#fff; font-weight:700; border:none; border-radius:8px; padding:12px 16px; cursor:pointer; margin:10px auto; display:block; width:100%; max-width:520px; }
  .btn:hover, .answer-btn:hover { background:#3A7FBF; }
  #backBtn { max-width:160px; padding:8px 12px; }
  .hidden{ display:none; }
  .progress-bar-container{ width:100%; max-width:520px; height:10px; background:#E0E0E0; border-radius:5px; margin:8px auto 4px; }
  .progress-bar{ height:100%; background:#FF4D4D; border-radius:5px; transition:width .25s; }
  .muted{ color:#9aa3ab; text-align:center; margin-top:12px; }
  .muted a:link, .muted a:visited { color:#9aa3ab; text-decoration:none; }
  .muted a:hover { color:#9aa3ab; text-decoration:underline; }

  /* Utility tweaks */
  .lh-13 { line-height: 1.3; }
  .mt-24pt { margin-top: 24pt !important; }

  /* Ranking UI */
  .rank-wrap { max-width: 760px; margin: 10px auto; }
  .rank-help { text-align:center; margin:8px 0 14px; }
  .rank-list { list-style:none; padding:0; margin:0; }
  .rank-item {
    display:flex; align-items:center; gap:10px;
    background:#fff; border:1px solid #4D9DE0; border-radius:8px;
    padding:10px 12px; margin:8px 0; cursor:grab;
  }
  .rank-item.dragging{ opacity:.6; }
  .rank-badge{ min-width:28px; height:28px; display:inline-flex; align-items:center; justify-content:center; border-radius:50%; background:#4D9DE0; color:#fff; font-weight:700; }
  .rank-title{ font-weight:700; }
  .rank-actions { margin-left:auto; display:flex; gap:6px; }
  .rank-actions button { padding:6px 10px; font-size:.9rem; border-radius:6px; border:1px solid #4D9DE0; background:#fff; color:#1A3C5E; cursor:pointer; }
  .rank-actions button:hover{ background:#f0f6ff; }

  /* Q buttons & pills */
  .question-box { background:#fff; border:1px solid #4D9DE0; border-radius:8px; padding:16px; margin:14px auto; max-width:760px; }
  .vertical-list .answer-btn{ margin:8px auto; max-width:760px; }
  .pill { display:inline-block; padding:8px 12px; border-radius:999px; border:1px solid #d0d7de; margin:6px; cursor:pointer; }
  .pill.selected{ background:#3A7FBF; border-color:#3A7FBF; color:#fff; }

  /* Results */
  .result-block { margin-bottom:16px; page-break-inside:avoid; padding:16px; border-left:8px solid #4D9DE0; border-radius:8px; background:#fff; }
  .section-title { color:#1A3C5E; font-family:'Open Sans',sans-serif; font-weight:700; font-size:16pt; margin-bottom:10px; }
  .subsection-title { color:#1A3C5E; font-family:'Roboto',sans-serif; font-weight:600; font-size:14pt; margin: 15px 0 8px; text-align:center; }
  .section-divider{ height:1pt; background-color:#FF4D4D; width:100%; max-width:860px; margin:24pt auto; }
  .subsection-divider{ height:1pt; background-color:rgba(77,157,224,.5); width:100%; max-width:860px; margin:14pt auto; }
  .verse{ font-family:'Merriweather', serif; font-style:italic; color:#FF4D4D; text-align:center; margin:4px auto 10px; max-width:820px; }
  .intro-text{ margin:8px auto 12px; line-height:1.45; }
  .partner-header{ font-weight:700; text-align:center; margin-bottom:6px; }

  .results-list{ list-style-position:outside; margin-left:20px; text-align:left; }
  .results-list li{ margin-bottom:6px; }

  /* Discussion Prompts highlight = light blue */
  .prompt-block {
    border-left:8px solid #4D9DE0;
    background: rgba(77,157,224,0.08);
    border-radius:8px; padding:16px; margin:16px 0;
  }

  .partner-subhead{ text-align:center; margin:6px 0 6px; }

  /* Friendly Thank You title centered in Pacifico */
  .thank-title{
    margin-top:0;
    font-family:'Pacifico', cursive;
    color:#4D9DE0;
    font-size:2.2rem; /* larger, warm & friendly */
    line-height:1.2;
    text-align:center;
  }

  @media (max-width:700px){
    .rank-wrap, .question-box { padding:14px; }
  }
</style>
</head>
<body>

<!-- Intro -->
<div id="introPage" class="card">
  <img src="https://static.wixstatic.com/media/4d6372_c110ccf05896482192f466d6c0e3c1ae~mv2.png" alt="Logo" style="display:block; margin:0 auto 12px; max-width:200px;" onerror="this.src='https://via.placeholder.com/200x80?text=Logo'">
  <h1>Your Guide to a Deeper Connection</h1>
  <div class="intro-text">
    <p style="text-align:center;"><em>Ready for a few “aha!” moments?</em></p>
    <p>This is a moment for you to reflect on what builds intimacy and how you navigate daily life.</p>
    <p>When you’re done, you’ll see a personalized profile with insights and practical ideas you can put to work right away.</p>

    <p style="margin-bottom:0.2em;"><strong>How it works:</strong></p>
    <div class="lh-13" style="margin-top:0;">
      <p style="margin:0;">Enter your name and tap Start. Answer each prompt honestly—there are no “right” answers.</p>
    </div>
  </div>
  <div class="row mt-24pt" style="display:flex; gap:12px; justify-content:center; flex-wrap:wrap;">
    <input id="yourName" class="input" placeholder="Your name" aria-label="Your name" style="border:1px solid #4D9DE0; border-radius:8px; padding:10px 12px; min-width:260px;">
  </div>
  <button id="startBtn" class="btn" style="max-width:260px;">Start Assessment</button>
  <p class="muted"><a href="https://happymarriagehappylife.com" target="_blank" rel="noopener">HappyMarriageHappyLife.com</a></p>
</div>

<!-- Quiz -->
<div id="quizPage" class="card hidden">
  <h2 id="quizTitle">Assessment</h2>
  <div class="progress-bar-container"><div class="progress-bar" id="progressBar"></div></div>
  <div id="progress" style="text-align:center; margin-bottom:8px;"></div>
  <div id="questionContainer" class="question-box"></div>
  <div style="display:flex; gap:10px; justify-content:center;">
    <button id="backBtn" class="btn" style="display:none; max-width:160px;">Back</button>
  </div>
  <p class="muted"><a href="https://happymarriagehappylife.com" target="_blank" rel="noopener">HappyMarriageHappyLife.com</a></p>
</div>

<!-- Results -->
<div id="resultPage" class="card hidden">
  <img src="https://static.wixstatic.com/media/4d6372_c110ccf05896482192f466d6c0e3c1ae~mv2.png" alt="Logo" style="display:block; margin:0 auto 12px; max-width:200px;" onerror="this.src='https://via.placeholder.com/200x80?text=Logo'">
  <h2 id="resultsHeader">Your Marriage Connection Profile</h2>
  <div id="resultsIntro" class="intro-text">
    <p>Welcome to the Marriage Connection Assessment, a guided experience designed to help you build a covenant, joy-filled marriage as God designed.</p>
    <p>This is your personalized guide to understanding connection in a new way. Think of this not as a set of labels, but as a living map to the unique landscape of your relationship—it helps you name what’s true today and aim for what’s possible tomorrow.</p>
  </div>
  <div id="results"></div>
  <p class="muted"><a href="https://happymarriagehappylife.com" target="_blank" rel="noopener">HappyMarriageHappyLife.com</a></p>
</div>

<script>
/* ================== Data ================== */
const INTIMACY = {
  Spiritual:{label:"Spiritual Intimacy", desc:"Anchors the relationship in God’s design and purpose. It governs how love is defined and lived out."},
  Emotional:{label:"Emotional Intimacy", desc:"Enables vulnerability, empathy, and emotional safety. It opens the door to all other forms of closeness."},
  Commitment:{label:"Commitment Intimacy", desc:"The covenant glue. It provides the security needed to face challenges and grow deeper in all other areas."},
  Intellectual:{label:"Intellectual Intimacy", desc:"Connecting through thoughts, values, and deep conversations."},
  Affable:{label:"Affable Intimacy", desc:"Agreeable, easy going, peaceful, social, and ease in your interactions."},
  Conflict:{label:"Conflict Intimacy", desc:"Staying connected in disagreement."},
  Recreational:{label:"Recreational Intimacy", desc:"Laughter, playfulness, enjoying life and shared experiences together."},
  Partnership:{label:"Partnership Intimacy", desc:"Managing responsibilities and making decisions together."},
  Stability:{label:"Financial Intimacy (Stability)", desc:"Transparent, honest, and value-aligned management of resources like time and money, fostering trust and stability."},
  Creative:{label:"Creative Intimacy", desc:"Dreaming, building, or creating things together."},
  Physical:{label:"Physical Intimacy", desc:"Touch, presence, comfort, and non-sexual affection."},
  Sexual:{label:"Sexual Intimacy", desc:"Passionate, exclusive, and sacred physical union."}
};
const TYPES = Object.keys(INTIMACY);

const typeColors = {
  Spiritual:"#6A4C93", Emotional:"#FF7A70", Commitment:"#FFB347",
  Intellectual:"#4C6B9B", Affable:"#FFB6C1", Recreational:"#4DD2FF",
  Partnership:"#3CB371", Stability:"#FFD700", Creative:"#FF66CC",
  Conflict:"#FFA552", Physical:"#FF8C69", Sexual:"#E63946"
};
const typeOpac = {
  Spiritual:"rgba(106,76,147,.08)", Emotional:"rgba(255,122,112,.08)", Commitment:"rgba(255,179,71,.08)",
  Intellectual:"rgba(76,107,155,.08)", Affable:"rgba(255,182,193,.08)", Recreational:"rgba(77,210,255,.08)",
  Partnership:"rgba(60,179,113,.08)", Stability:"rgba(255,215,0,.08)", Creative:"rgba(255,102,204,.08)",
  Conflict:"rgba(255,165,82,.08)", Physical:"rgba(255,140,105,.08)", Sexual:"rgba(230,57,70,.08)"
};

const scripture = {
  coreStrengths: "“Above all, love each other deeply, because love covers over a multitude of sins.” — 1 Peter 4:8",
  areasForGrowth: "“Let us consider how we may spur one another on toward love and good deeds.” — Hebrews 10:24",
  untappedOpps: "“See, I am doing a new thing! … Do you not perceive it?” — Isaiah 43:19",

  compassionCare: "“Be completely humble and gentle; be patient, bearing with one another in love.” — Ephesians 4:2",
  socialEngagement: "“Therefore encourage one another and build each other up.” — 1 Thessalonians 5:11",
  decisionLeadership: "“If any of you lacks wisdom, you should ask God … and it will be given to you.” — James 1:5",
  respectRecognition: "“Honor one another above yourselves.” — Romans 12:10",
  connectionPattern: "“Make every effort to keep the unity of the Spirit through the bond of peace.” — Ephesians 4:3",
  conflictStrategies: "“Everyone should be quick to listen, slow to speak and slow to become angry.” — James 1:19",
  thankYou: "“May the Lord make your love increase and overflow for each other and for everyone else, just as ours does for you.” — 1 Thessalonians 3:12"
};

/* Temperament accents (Sanguine/Choleric/Melancholy/Phlegmatic/Supine) */
function temperamentAccentFromKey(k){
  const map = {
    E: { color: typeColors.Emotional,    bg: typeOpac.Emotional    }, // Sanguine
    S: { color: typeColors.Commitment,   bg: typeOpac.Commitment   }, // Choleric
    R: { color: typeColors.Intellectual, bg: typeOpac.Intellectual }, // Melancholy
    A: { color: typeColors.Affable,      bg: typeOpac.Affable      }, // Phlegmatic
    U: { color: typeColors.Partnership,  bg: typeOpac.Partnership  }  // Supine
  };
  return map[k] || { color:"#4D9DE0", bg:"rgba(77,157,224,.08)" };
}
function temperamentAccentFromAffKey(k){
  // Playful→E, Initiative→S, DeepTalk→R, Warmth→A, Support→U
  const t = { Playful:"E", Initiative:"S", DeepTalk:"R", Warmth:"A", Support:"U" }[k];
  return temperamentAccentFromKey(t);
}

/* Rich copy for Compassion & Care (expressed/desired) */
const affEXP = {
  Playful: "You naturally lift the mood with humor, lightness, and spontaneous moments that say, “I’m with you.” You turn ordinary spaces into warm, safe places.",
  Initiative: "You show love by stepping in and taking pressure off—solving problems, removing obstacles, and protecting what matters.",
  DeepTalk: "You invite depth—lingering in meaningful conversation, asking curious questions, and making others feel profoundly understood.",
  Warmth: "You offer steady presence and gentle affection. Your calming tone, touch, and attention help your spouse exhale and feel safe.",
  Support: "You love through action: pitching in, following through, and sharing the load. Your reliability says, “You’re not alone—I'm with you.”"
};
const affDES = {
  Playful: "You feel loved when your spouse keeps things light, playful, and hope-filled—like a breath of fresh air when life feels heavy.",
  Initiative: "You feel most cared for when your spouse takes initiative—removing stress, solving a problem, or leading with strength and protection.",
  DeepTalk: "You feel cherished when your spouse slows down, listens deeply, and engages your thoughts and heart with focused, meaningful time.",
  Warmth: "You feel secure with gentle presence, unhurried attention, and comforting touch that says, “I’m here, and you matter.”",
  Support: "You feel honored when your spouse helps practically—sharing responsibilities and showing up consistently in the daily things."
};

/* Social/Decision details */
const temperamentDetails = {
  E: { looks:"You energize the room and move things forward with enthusiasm.",
       watch:"Fast pace can out-run deeper needs or quieter voices.",
       tip:"Plan both lively connection and quiet check-ins to stay balanced." },
  S: { looks:"You provide direction, set goals, and protect progress.",
       watch:"Decisiveness can feel controlling if not co-authored.",
       tip:"Invite input early and name where you’re flexible." },
  R: { looks:"You think deeply, ask great questions, and value thoughtfulness.",
       watch:"Over-analysis can delay decisions or feel distant.",
       tip:"Time-box decisions and surface feelings—not just facts." },
  A: { looks:"You bring calm, keep the peace, and reduce friction.",
       watch:"Avoiding tension can postpone needed clarity.",
       tip:"Name one concrete next step even when keeping it gentle." },
  U: { looks:"You serve steadily, include others, and build trust.",
       watch:"Understating your needs can lead to quiet resentment.",
       tip:"Voice one specific need and one boundary you appreciate." }
};

/* R&R extras */
function rrExtra(label){
  if(label==="Strong")   return "You generally feel honored and seen—keep naming specific appreciations to reinforce that culture.";
  if(label==="Moderate") return "You’re often valued, but clarity helps. Agree on simple ways to say “I see you” each week.";
  return "Name the kinds of affirmation that matter and invite a daily “one sentence appreciation” for a week.";
}

/* Connection pattern extras */
const patternExtras = {
  SteadyConnector: "Use a short daily “check-in” ritual so small tensions resolve early.",
  ReassuranceSeeker: "Agree on a quick reassurance phrase, then pause to prevent spirals.",
  IndependentConnector: "Set a clear “return time” after space so distance doesn’t become disconnection.",
  GuardedConnector: "Start with micro-trust gestures (small keeps) before heavy talk."
};

/* ================== Flow/State ================== */
let yourName = "";
const TOTAL_STEPS = 13;
let step = 0;
let answers = {
  rank: [...TYPES],
  expressedTop2: [],
  desiredTop2: [],
  social: {},
  decision: {},
  rr: { rr1:null, rr2:null },
  bond: {}
};

/* Boot */
document.getElementById('startBtn').onclick = () => {
  yourName = document.getElementById('yourName').value.trim();
  if(!yourName){ alert("Please enter your name to begin."); return; }
  hideAllPages();
  document.getElementById('quizPage').classList.remove('hidden');
  document.getElementById('quizTitle').textContent = `Assessment — ${yourName}`;
  step = 0;
  renderStep();
};
document.getElementById('backBtn').onclick = () => { if(step>0){ step--; renderStep(); } };
function hideAllPages(){
  document.getElementById('introPage').classList.add('hidden');
  document.getElementById('quizPage').classList.add('hidden');
  document.getElementById('resultPage').classList.add('hidden');
}

/* Steps */
function renderStep(){
  document.getElementById('progress').textContent = `Step ${step+1} of ${TOTAL_STEPS}`;
  document.getElementById('progressBar').style.width = `${((step+1)/TOTAL_STEPS)*100}%`;
  const box = document.getElementById('questionContainer');
  box.innerHTML = "";
  document.getElementById('backBtn').style.display = step>0 ? 'block' : 'none';

  if(step===0) return renderRankUI(box);
  if(step===1) return renderPick2(box, "How you give love — choose your Top 2", "expressedTop2");
  if(step===2) return renderPick2(box, "How you feel most loved — choose your Top 2", "desiredTop2");
  if(step===3) return renderSingleList(box, "In groups, I usually…", [
    ["E","Bring energy and get people talking."],
    ["S","Organize or give structure to the time."],
    ["R","Connect deeply with one or two people."],
    ["A","Keep it light, calm, and agreeable."],
    ["U","Make sure everyone feels included."]
  ], key => { answers.social["social1"]=key; next(); });
  if(step===4) return renderSingleList(box, "Planning social time, I prefer…", [
    ["E","Lively, people-filled activities."],
    ["S","A clear plan that keeps us on track."],
    ["R","Meaningful, low-key connection."],
    ["A","Relaxed, pressure-free time."],
    ["U","Including others thoughtfully."]
  ], key => { answers.social["social2"]=key; next(); });
  if(step===5) return renderSingleList(box, "When a decision is needed, I tend to…", [
    ["E","Choose the fun option and keep momentum."],
    ["S","Decide quickly and set direction."],
    ["R","Analyze details before choosing."],
    ["A","Seek harmony and avoid friction."],
    ["U","Support the plan and contribute steadily."]
  ], key => { answers.decision["decision1"]=key; next(); });
  if(step===6) return renderSingleList(box, "On shared projects at home, I usually…", [
    ["E","Keep things upbeat and moving."],
    ["S","Take the lead and drive results."],
    ["R","Plan details and set a thoughtful pace."],
    ["A","Stay flexible and avoid conflict."],
    ["U","Pitch in steadily and support the plan."]
  ], key => { answers.decision["decision2"]=key; next(); });
  if(step===7) return renderSingleList(box, "I feel my opinions are respected in our relationship.", [
    [3,"Strongly Agree"], [2,"Agree"], [1,"Disagree"], [0,"Strongly Disagree"]
  ], val => { answers.rr.rr1 = Number(val); next(); });
  if(step===8) return renderSingleList(box, "We are aligned on core values and honor our covenant.", [
    [3,"Strongly Agree"], [2,"Agree"], [1,"Disagree"], [0,"Strongly Disagree"]
  ], val => { answers.rr.rr2 = Number(val); next(); });
  if(step===9) return renderSingleList(box, "During conflict, I naturally…", [
    ["SteadyConnector","Use humor to lower tension."],
    ["ReassuranceSeeker","Push for quick resolution."],
    ["IndependentConnector","Withdraw to think it through."],
    ["IndependentConnector","Stay calm to avoid escalation."],
    ["GuardedConnector","Concede just to end it."]
  ], key => { answers.bond["bond1"]=key; next(); });
  if(step===10) return renderSingleList(box, "When I feel unappreciated, I tend to…", [
    ["SteadyConnector","Laugh it off and move on."],
    ["ReassuranceSeeker","Remind my spouse of my effort."],
    ["IndependentConnector","Feel overlooked and pull back."],
    ["IndependentConnector","Let it go to keep peace."],
    ["GuardedConnector","Feel hurt and shut down."]
  ], key => { answers.bond["bond2"]=key; next(); });
  if(step===11) return renderSingleList(box, "After a disagreement, I prefer to…", [
    ["ReassuranceSeeker","Repair quickly together."],
    ["IndependentConnector","Pause, then reconnect with a plan."]
  ], key => { answers.bond["bond3"]=key; next(); });
  if(step===12) return renderSingleList(box, "When overwhelmed, I prefer to…", [
    ["ReassuranceSeeker","Seek closeness and reassurance now."],
    ["IndependentConnector","Have space first, then return to talk."]
  ], key => { answers.bond["bond4"]=key; finalize(); });
}

function renderRankUI(root){
  const wrap = document.createElement('div');
  wrap.className = 'rank-wrap';
  wrap.innerHTML = `
    <h3 style="text-align:center;">Rank the 12 Intimacy Types</h3>
    <p class="rank-help">Drag to reorder (or use ↑ / ↓). Place your most important at the top.</p>
    <ul id="rankList" class="rank-list"></ul>
    <button id="rankContinue" class="btn" style="max-width:260px;">Save Ranking & Continue</button>
  `;
  root.appendChild(wrap);
  const ul = wrap.querySelector('#rankList');
  refreshRankList(ul);
  let dragEl = null;
  ul.addEventListener('dragstart', e=>{ if(e.target.classList.contains('rank-item')){ dragEl=e.target; e.dataTransfer.effectAllowed='move'; e.target.classList.add('dragging'); }});
  ul.addEventListener('dragend', ()=>{ if(dragEl){ dragEl.classList.remove('dragging'); dragEl=null; }});
  ul.addEventListener('dragover', e=>{
    e.preventDefault();
    const after = getAfter(ul, e.clientY);
    const dragging = ul.querySelector('.dragging');
    if(!dragging) return;
    if(!after) ul.appendChild(dragging); else ul.insertBefore(dragging, after);
  });
  ul.addEventListener('drop', ()=>{ answers.rank = [...ul.querySelectorAll('.rank-item')].map(li=>li.dataset.key); refreshRankList(ul); });
  function getAfter(container, y){
    const els=[...container.querySelectorAll('.rank-item:not(.dragging)')];
    return els.reduce((closest,child)=>{
      const box=child.getBoundingClientRect(); const offset=y-box.top-box.height/2;
      if(offset<0 && offset>closest.offset) return {offset,element:child}; else return closest;
    }, {offset:-Infinity}).element;
  }
  document.getElementById('rankContinue').onclick = ()=>{
    answers.rank = [...ul.querySelectorAll('.rank-item')].map(li=>li.dataset.key);
    if(answers.rank.length!==12){ alert("Please rank all 12 types."); return; }
    next();
  };
}
function refreshRankList(ul){
  ul.innerHTML = "";
  answers.rank.forEach((k, idx)=>{
    const li = document.createElement('li');
    li.className = 'rank-item';
    li.draggable = true;
    li.dataset.key = k;
    li.innerHTML = `
      <span class="rank-badge">${idx+1}</span>
      <div>
        <div class="rank-title">${INTIMACY[k].label}</div>
        <div style="font-size:.9rem;color:#4a607a;">${INTIMACY[k].desc}</div>
      </div>
      <div class="rank-actions">
        <button type="button" aria-label="Move up">↑</button>
        <button type="button" aria-label="Move down">↓</button>
      </div>
    `;
    const [upBtn, downBtn] = li.querySelectorAll('.rank-actions button');
    upBtn.onclick = ()=>{ const i=answers.rank.indexOf(k); if(i>0){ [answers.rank[i-1],answers.rank[i]]=[answers.rank[i],answers.rank[i-1]]; refreshRankList(ul);} };
    downBtn.onclick = ()=>{ const i=answers.rank.indexOf(k); if(i<answers.rank.length-1){ [answers.rank[i+1],answers.rank[i]]=[answers.rank[i],answers.rank[i+1]]; refreshRankList(ul);} };
    ul.appendChild(li);
  });
}

/* Pick-2 */
const affectionOptions = [
  {key:"Playful", text:"Playful moments and upbeat encouragement"},
  {key:"Initiative", text:"Taking initiative—removing stressors"},
  {key:"DeepTalk", text:"Deep conversation and focused time"},
  {key:"Warmth", text:"Warm presence and gentle touch"},
  {key:"Support", text:"Practical help and steady teamwork"}
];
function renderPick2(root, title, field){
  const selected = answers[field];
  const div = document.createElement('div');
  div.innerHTML = `<h3 style="text-align:center;">${title}</h3>
    <p class="rank-help">Tap to select two. Your first tap is #1, second is #2. Tap again to unselect.</p>
    <div id="pick2Wrap" style="text-align:center;"></div>
    <p style="text-align:center; margin-top:8px;">Selected: <strong>${selected.map((k,i)=>`${i+1}. ${labelFor(k)}`).join("  ")||"—"}</strong></p>`;
  root.appendChild(div);
  const wrap = div.querySelector('#pick2Wrap');
  affectionOptions.forEach(o=>{
    const pill = document.createElement('span');
    pill.className = 'pill' + (selected.includes(o.key) ? ' selected' : '');
    pill.textContent = o.text;
    pill.onclick = ()=>{
      if(selected.includes(o.key)){
        answers[field] = selected.filter(x=>x!==o.key);
        renderStep();
      }else{
        if(selected.length<2){
          answers[field] = [...selected, o.key];
          if(answers[field].length===2) return next();
          renderStep();
        }
      }
    };
    wrap.appendChild(pill);
  });
}
function labelFor(k){
  return {Playful:"Playful moments", Initiative:"Taking initiative", DeepTalk:"Deep conversation", Warmth:"Warm presence & touch", Support:"Practical support"}[k]||k;
}

/* Single-choice helper */
function renderSingleList(root, title, options, onPick){
  root.innerHTML = `<h3 style="text-align:center;">${title}</h3><div class="vertical-list"></div>`;
  const v = root.querySelector('.vertical-list');
  options.forEach(([val, txt])=>{
    const b = document.createElement('button');
    b.className = 'answer-btn';
    b.textContent = txt;
    b.onclick = ()=> onPick(val);
    v.appendChild(b);
  });
}
function next(){ step++; (step<TOTAL_STEPS)? renderStep() : finalize(); }

/* Finalize & Results */
function finalize(){
  // Social/Decision tops + summaries
  const socialCounts = {E:0,S:0,R:0,A:0,U:0}; Object.values(answers.social).forEach(k=> socialCounts[k]++);
  const decisionCounts = {E:0,S:0,R:0,A:0,U:0}; Object.values(answers.decision).forEach(k=> decisionCounts[k]++);
  const socialTop = Object.entries(socialCounts).sort((a,b)=>b[1]-a[1])[0]?.[0] || null;
  const decisionTop = Object.entries(decisionCounts).sort((a,b)=>b[1]-a[1])[0]?.[0] || null;

  const socialSummary = socialTop ? ({
    E:"You bring energy and enthusiasm to social settings.",
    S:"You give structure and help lead groups well.",
    R:"You prefer deep, thoughtful conversations.",
    A:"You value calm, low-key connection.",
    U:"You make sure others feel included and cared for."
  })[socialTop] : "You adapt flexibly to different situations.";

  const decisionSummary = decisionTop ? ({
    E:"You decide with enthusiasm, prioritizing enjoyment and momentum.",
    S:"You decide decisively, goal-first.",
    R:"You analyze carefully before choosing.",
    A:"You seek harmony and consensus.",
    U:"You steadily support plans and shared goals."
  })[decisionTop] : "You adapt flexibly to different situations.";

  // R&R
  const rrScore = (answers.rr.rr1 ?? 0) + (answers.rr.rr2 ?? 0);
  const rrLabel = rrScore>=5 ? "Strong" : rrScore>=3 ? "Moderate" : "Needs Attention";

  // Bonding
  const bondCounts = {SteadyConnector:0, ReassuranceSeeker:0, IndependentConnector:0, GuardedConnector:0};
  Object.values(answers.bond).forEach(k=> bondCounts[k]++);
  const bondingKey = Object.entries(bondCounts).sort((a,b)=>b[1]-a[1])[0]?.[0] || "SteadyConnector";

  const profile = {
    name: yourName,
    coreTypes: answers.rank.slice(0,4),
    growthTypes: answers.rank.slice(4,8),
    untappedTypes: answers.rank.slice(8,12),
    expressedTop2: [...answers.expressedTop2],
    desiredTop2: [...answers.desiredTop2],
    socialTop, decisionTop, socialSummary, decisionSummary,
    rrScore, rrLabel, bondingKey
  };

  renderResults(profile);
}

function renderResults(p){
  hideAllPages();
  document.getElementById('resultPage').classList.remove('hidden');
  document.getElementById('resultsHeader').textContent = "Your Marriage Connection Profile";

  const container = document.createElement('div'); container.id = "soloReport";

  /* Section 1 */
  container.innerHTML += `
    <div class="section-divider"></div>
    <h3 class="section-title">Section 1: Your Intimacy Preferences</h3>
    <div class="intro-text">
      This section is all about understanding intimacy—the profound experience of being truly known, deeply connected, and fully cherished by your spouse. It reveals your unique connection profile, showing how you naturally express love and how you feel most loved in return.
      <p>Our model organizes intimacy into 12 distinct types that span all dimensions of human experience, wisely combining the essential aspects of 'being together' (like emotional bonding and spiritual connection) and 'doing together' (like shared effort and practical unity). This approach reflects how love truly thrives in real-life marriage. These types represent crucial points of connection (and sometimes conflict), and understanding your preferences gives you a shared language to express needs and navigate connection.</p>
    </div>

    <div class="subsection-divider"></div>
    <h4 class="subsection-title">Your Core Connection Strengths</h4>
    <div class="verse">${scripture.coreStrengths}</div>
    <p class="intro-text">Based on your unique profile, these are your most fulfilling and effortless pathways to deeper closeness. They highlight your natural strengths and the incredible ways you genuinely thrive.</p>
    ${typesColumn(p.name, p.coreTypes)}

    ${promptsBlock([
      "<em>Explore:</em> Why does each strength matter to you, and when do you feel most connected through it?",
      "<em>Be Creative:</em> Pick one practical way to use a strength intentionally this week.",
      "<em>Share:</em> Name a recent moment you felt especially connected through one of these types."
    ])}

    <div class="subsection-divider"></div>
    <h4 class="subsection-title">Your Areas for Growth</h4>
    <div class="verse">${scripture.areasForGrowth}</div>
    <p class="intro-text">You'll find these areas are wonderful opportunities for intentional focus. With a bit of practice and presence, you can deepen connection here.</p>
    ${typesColumn(p.name, p.growthTypes)}

    ${promptsBlock([
      "<em>One small step:</em> Choose a 10-minute practice for one growth area.",
      "<em>Support plan:</em> What would help you show up here more consistently?"
    ])}

    <div class="subsection-divider"></div>
    <h4 class="subsection-title">Your Untapped Opportunities</h4>
    <div class="verse">${scripture.untappedOpps}</div>
    <p class="intro-text">These aren't weaknesses at all—think of them as exciting, untapped gifts to discover. Exploring them can add surprising depth and joy.</p>
    ${typesColumn(p.name, p.untappedTypes)}

    ${promptsBlock([
      "<em>Pick one:</em> Which untapped type feels most intriguing right now?",
      "<em>Try it:</em> Design a tiny experiment you can do this week.",
      "<em>Reflect:</em> What did you enjoy or learn?"
    ])}
  `;

  /* Section 2 */
  container.innerHTML += `
    <div class="section-divider"></div>
    <h3 class="section-title">Section 2: Relational Dynamics</h3>
    <div class="intro-text">
      Your relationship isn’t just a connection—it’s a unique dance of two beautiful, distinct individuals! This section clarifies the everyday rhythms that shape your connection.
    </div>

    <div class="subsection-divider"></div>
    <h4 class="subsection-title">Compassion & Care</h4>
    <div class="verse">${scripture.compassionCare}</div>
    <p class="intro-text">How love, empathy, and emotional needs are expressed and received. This is where you answer, “Do you care about me?”—both in how you show up and how you long to be comforted.</p>
    ${compassionColumn(p)}

    <div class="subsection-divider"></div>
    <h4 class="subsection-title">Social Preferences</h4>
    <div class="verse">${scripture.socialEngagement}</div>
    ${temperamentBlock(p.name, "Your Social Energy", buildTemperamentText(p.socialTop, p.socialSummary), p.socialTop)}

    <div class="subsection-divider"></div>
    <h4 class="subsection-title">Power & Control</h4>
    <div class="verse">${scripture.decisionLeadership}</div>
    ${temperamentBlock(p.name, "Your Leadership Style", buildTemperamentText(p.decisionTop, p.decisionSummary), p.decisionTop)}

    <div class="subsection-divider"></div>
    <h4 class="subsection-title">Respect & Recognition</h4>
    <div class="verse">${scripture.respectRecognition}</div>
    ${rrCard(p)}
  `;

  /* Section 3 */
  container.innerHTML += `
    <div class="section-divider"></div>
    <h3 class="section-title">Section 3: Connection Patterns</h3>
    <div class="verse">${scripture.connectionPattern}</div>
    <p class="intro-text">Everyone has a unique pattern for how they approach connection and conflict. These results show how you tend to respond to perceived conflict and how you desire to repair afterward. Learning your strengths, challenges, and blind spots here is key to a healthier, more resilient relationship.</p>
    ${patternColumn(p)}

    <div class="subsection-divider"></div>
    <h4 class="subsection-title">Your Personalized Repair Plan</h4>
    ${strategySelfCard(p.bondingKey)}

    <div class="section-divider"></div>
    <div class="result-block" style="border-left-color:transparent; background:#fff;">
      <h3 class="thank-title">Thank You</h3>
      <div class="verse">${scripture.thankYou}</div>
      <p class="intro-text">We hope you had fun discovering your unique connection patterns. Use these insights as a friendly guide—not labels—to spark great conversations and small, consistent changes.</p>
      <p class="intro-text">To be truly known is to unlock the deepest intimacy—embrace what's true today and aim courageously for what's possible tomorrow.</p>
    </div>
  `;

  document.getElementById('results').innerHTML = "";
  document.getElementById('results').appendChild(container);
}

/* ======= Results helpers ======= */
function typesColumn(name, types){
  return `
    <div class="partner-card"><div class="partner-inner">
      <div class="partner-header">${name}</div>
      ${types.map(k=>`
        <div class="result-block" style="border-left-color:${typeColors[k]}; background:${typeOpac[k]};">
          <strong>${INTIMACY[k].label}</strong> — ${INTIMACY[k].desc}
        </div>
      `).join("")}
    </div></div>
  `;
}

function compassionColumn(p){
  const exp = p.expressedTop2.map(k=>{
    const acc = temperamentAccentFromAffKey(k);
    return `<div class="result-block" style="border-left-color:${acc.color}; background:${acc.bg};">
      <strong>Expressed:</strong> ${affEXP[k]}
    </div>`;
  }).join("");
  const des = p.desiredTop2.map(k=>{
    const acc = temperamentAccentFromAffKey(k);
    return `<div class="result-block" style="border-left-color:${acc.color}; background:${acc.bg};">
      <strong>Most Loved:</strong> ${affDES[k]}
    </div>`;
  }).join("");
  return `
    <div class="partner-card"><div class="partner-inner">
      <div class="partner-header">${p.name}</div>
      <div class="partner-subhead"><strong>${p.name} — You Express Love</strong></div>
      ${exp}
      <div class="partner-subhead"><strong>${p.name} — You Feel Most Loved</strong></div>
      ${des}
    </div></div>
  `;
}

function buildTemperamentText(topKey, summary){
  if(!topKey) return summary;
  const d = temperamentDetails[topKey] || {};
  return `${summary} <br><em>What it looks like:</em> ${d.looks || ""} <br><em>Watch-outs:</em> ${d.watch || ""} <br><em>Helpful tip:</em> ${d.tip || ""}`;
}

function temperamentBlock(name, title, text, topKey){
  const acc = temperamentAccentFromKey(topKey);
  return `
    <div class="result-block" style="border-left-color:${acc.color}; background:${acc.bg};">
      <strong>${name} — ${title}:</strong> <span>${text}</span>
    </div>
  `;
}

function rrAccent(label){
  if(label==="Strong")   return { color:typeColors.Partnership, bg:typeOpac.Partnership };  // green
  if(label==="Moderate") return { color:typeColors.Commitment,  bg:typeOpac.Commitment  }; // yellow
  return { color:typeColors.Emotional, bg:typeOpac.Emotional };                              // red
}
function rrCard(p){
  const acc = rrAccent(p.rrLabel);
  return `
    <div class="result-block" style="border-left-color:${acc.color}; background:${acc.bg};">
      <strong>${p.name} — Respect &amp; Recognition:</strong> ${p.rrLabel} (${p.rrScore}/6)
      <p style="margin:8px 0 0;">${rrStatement(p.rrScore)}</p>
      <p style="margin:4px 0 0;"><em>${rrExtra(p.rrLabel)}</em></p>
    </div>
  `;
}

function patternColumn(p){
  const map = {
    SteadyConnector:{ color: typeColors.Partnership,  bg: typeOpac.Partnership,
      label:"Steady Connector", desc:"You create a safe space for open communication.",
      challenges:"You may assume quick talks fix everything.", style:"Seeks harmony; may avoid depth." },
    ReassuranceSeeker:{ color: typeColors.Emotional, bg: typeOpac.Emotional,
      label:"Reassurance Seeker", desc:"You thrive on frequent affirmations.",
      challenges:"Validation needs may overwhelm others.", style:"May over-pursue reassurance." },
    IndependentConnector:{ color: typeColors.Intellectual, bg: typeOpac.Intellectual,
      label:"Independent Connector", desc:"Calm, steady presence; values space.",
      challenges:"Space can feel like distance.", style:"May withdraw or shut down." },
    GuardedConnector:{ color: typeColors.Conflict,   bg: typeOpac.Conflict,
      label:"Guarded Connector", desc:"Builds trust gradually; dependable.",
      challenges:"Caution can slow openness.", style:"May assume negative intent." }
  };
  const info = map[p.bondingKey] || map.SteadyConnector;
  return `
    <div class="partner-card"><div class="partner-inner">
      <div class="partner-header">${p.name}</div>
      <div class="result-block" style="border-left-color:${info.color}; background:${info.bg};">
        <strong>${info.label}</strong>
        <p><strong>Strengths:</strong> ${info.desc}</p>
        <p><strong>Challenges:</strong> ${info.challenges}</p>
        <p><strong>Typical in Tension:</strong> ${info.style}</p>
        <p style="margin:6px 0 0;"><em>What helps:</em> ${patternExtras[p.bondingKey]}</p>
      </div>
    </div></div>
  `;
}

function strategySelfCard(bondingKey){
  const tips = {
    SteadyConnector: [
      "Schedule a 10-minute daily “check-in” to clear small tensions.",
      "When emotions rise, name one feeling + one need (keep it short).",
      "Close loops: agree on a next step before ending tough talks."
    ],
    ReassuranceSeeker: [
      "Ask for a specific reassurance (one sentence)—then breathe and pause.",
      "Use “I feel… I need…” instead of explanations or accusations.",
      "If spiraling, request a 10-minute reset with a promised return time."
    ],
    IndependentConnector: [
      "Ask for thinking space and set a clear return time (e.g., “20 minutes”).",
      "Share one sentence of reassurance before taking space.",
      "Come back with one concrete request and one compromise."
    ],
    GuardedConnector: [
      "Start with micro-trust gestures (keep one small promise daily).",
      "Name one safe topic you can open up about this week.",
      "Use written notes for tough truths, then discuss with kindness."
    ]
  }[bondingKey] || [];
  const acc = (bondingKey==="ReassuranceSeeker") ? { color: typeColors.Emotional, bg: typeOpac.Emotional }
            : (bondingKey==="IndependentConnector") ? { color: typeColors.Intellectual, bg: typeOpac.Intellectual }
            : (bondingKey==="GuardedConnector") ? { color: typeColors.Conflict, bg: typeOpac.Conflict }
            : { color: typeColors.Partnership, bg: typeOpac.Partnership };
  return `
    <div class="result-block" style="border-left-color:${acc.color}; background:${acc.bg};">
      <strong>Your Go-To Repair Moves</strong>
      <ul class="results-list" style="margin-top:6px;">
        ${tips.map(t=>`<li>${t}</li>`).join("")}
      </ul>
    </div>
  `;
}

/* Helpers */
function rrStatement(score){
  if(score>=5) return "You generally feel affirmed, appreciated, respected, and validated—and you likely offer the same in return.";
  if(score>=3) return "You often feel appreciated and respected, though there may be moments when clearer affirmation would be meaningful.";
  return "You may not consistently feel affirmed or validated; be explicit about the kinds of appreciation that help you feel respected.";
}
function promptsBlock(items){
  return `
    <div class="prompt-block">
      <strong>Discussion Prompts</strong>
      <ul class="results-list" style="margin-top:6px;">
        ${items.map(li=>`<li>${li}</li>`).join("")}
      </ul>
    </div>
  `;
}
</script>
</body>
</html>